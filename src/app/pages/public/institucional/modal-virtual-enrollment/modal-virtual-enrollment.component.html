<ng-template #modalVirtualEnrollment let-modal>
  <div class="modal-header bg-white border-bottom px-4">
    <div class="d-flex align-items-center">
      <i class="logo-geunica me-2"></i>
    </div>
    <button 
      type="button" 
      class="btn-close" 
      aria-label="Close"
      (click)="modal.dismiss()">
    </button>
  </div>

  <div class="modal-body bg-white py-3 px-5">
    <h4 class="text-center fw-semibold text-dark mb-4 fs-3">Inscripción virtual</h4>
    
    <!-- Progress Steps -->
    <div class="d-flex justify-content-center align-items-center mb-4">
      <!-- Paso 1 -->
      <div class="d-flex flex-column align-items-center">
        <div class="rounded-circle d-flex align-items-center justify-content-center fw-bold text-white mb-2"
             [class]="currentStep >= 1 ? 'bg-success' : 'bg-secondary'"
             style="width: 40px; height: 40px;">1</div>
        <small>Datos del alumno</small>
      </div>
      <div class="flex-fill mx-3">
        <hr [class]="currentStep > 1 ? 'border-success border-2' : 'border-secondary'">
      </div>
      <!-- Paso 2 -->
      <div class="d-flex flex-column align-items-center">
        <div class="rounded-circle d-flex align-items-center justify-content-center fw-bold text-white mb-2"
             [class]="currentStep >= 2 ? 'bg-success' : 'bg-secondary'"
             style="width: 40px; height: 40px;">2</div>
        <small>Datos del apoderado</small>
      </div>
      <div class="flex-fill mx-3">
        <hr [class]="currentStep > 2 ? 'border-success border-2' : 'border-secondary'">
      </div>
      <!-- Paso 3 -->
      <div class="d-flex flex-column align-items-center">
        <div class="rounded-circle d-flex align-items-center justify-content-center fw-bold text-white mb-2"
             [class]="currentStep >= 3 ? 'bg-success' : 'bg-secondary'"
             style="width: 40px; height: 40px;">3</div>
        <small>Verificar</small>
      </div>
    </div>

    <form>
      <!-- Step 1: Datos del alumno -->
      @if (currentStep === 1) {
        <div>
          <h5 class="fw-semibold mb-4">Datos del alumno</h5>
          
          <div class="row mb-3">
            <div class="col-md-4">
              <label class="form-label fw-medium small">Nombre *</label>
              <input 
                type="text" 
                class="form-control bg-light rounded" 
                placeholder="Nombre"
                [(ngModel)]="studentData.firstName"
                name="studentFirstName"
                required>
            </div>
            <div class="col-md-4">
              <label class="form-label fw-medium small">Apellido Paterno *</label>
              <input 
                type="text" 
                class="form-control bg-light rounded" 
                placeholder="Apellido Paterno"
                [(ngModel)]="studentData.paternalLastName"
                name="studentPaternalLastName"
                required>
            </div>
            <div class="col-md-4">
              <label class="form-label fw-medium small">Apellido Materno</label>
              <input 
                type="text" 
                class="form-control bg-light rounded" 
                placeholder="Apellido Materno"
                [(ngModel)]="studentData.maternalLastName"
                name="studentMaternalLastName">
            </div>
          </div>
          
          <div class="row mb-3">
            <div class="col-md-6">
              <label class="form-label fw-medium small">Tipo de Documento</label>
              <select 
                class="form-select bg-light rounded"
                [(ngModel)]="studentData.documentType"
                name="studentDocumentType">
                <option value="DNI">DNI</option>
                <option value="CE">Carnet de Extranjería</option>
                <option value="Pasaporte">Pasaporte</option>
              </select>
            </div>
            <div class="col-md-6">
              <label class="form-label fw-medium small">N° Documento *</label>
              <input 
                type="text" 
                class="form-control bg-light rounded" 
                placeholder="N° Documento"
                [(ngModel)]="studentData.documentNumber"
                name="studentDocumentNumber"
                required>
            </div>
          </div>
          
          <div class="row mb-3">
            <div class="col-md-6">
              <label class="form-label fw-medium small">Fecha de Nacimiento</label>
              <input 
                type="date" 
                class="form-control bg-light rounded"
                [(ngModel)]="studentData.birthDate"
                name="studentBirthDate">
            </div>
            <div class="col-md-6">
              <label class="form-label fw-medium small">Sexo</label>
              <select 
                class="form-select bg-light rounded"
                [(ngModel)]="studentData.gender"
                name="studentGender">
                <option value="">Seleccionar</option>
                <option value="Masculino">Masculino</option>
                <option value="Femenino">Femenino</option>
              </select>
            </div>
          </div>
          
          <div class="row mb-4">
            <div class="col-md-4">
              <label class="form-label fw-medium small">Celular</label>
              <input 
                type="tel" 
                class="form-control bg-light rounded" 
                placeholder="Celular"
                [(ngModel)]="studentData.phone"
                name="studentPhone">
            </div>
            <div class="col-md-4">
              <label class="form-label fw-medium small">Dirección</label>
              <input 
                type="text" 
                class="form-control bg-light rounded" 
                placeholder="Dirección"
                [(ngModel)]="studentData.address"
                name="studentAddress">
            </div>
            <div class="col-md-4">
              <label class="form-label fw-medium small">Correo Electrónico</label>
              <input 
                type="email" 
                class="form-control bg-light rounded" 
                placeholder="Correo Electrónico"
                [(ngModel)]="studentData.email"
                name="studentEmail">
            </div>
          </div>
          
          <h6 class="fw-bold mb-3">Nivel académico</h6>
          <div class="row mb-4">
            <div class="col-md-6">
              <label class="form-label fw-medium small">Nivel *</label>
              <select 
                class="form-select bg-light rounded"
                [(ngModel)]="studentData.level"
                name="studentLevel"
                required>
                <option value="">Seleccionar</option>
                <option value="Primaria">Primaria</option>
                <option value="Secundaria">Secundaria</option>
              </select>
            </div>
            <div class="col-md-6">
              <label class="form-label fw-medium small">Grado *</label>
              <select 
                class="form-select bg-light rounded"
                [(ngModel)]="studentData.grade"
                name="studentGrade"
                required>
                <option value="">Seleccionar</option>
                <option value="1ro">1ro</option>
                <option value="2do">2do</option>
                <option value="3ro">3ro</option>
                <option value="4to">4to</option>
                <option value="5to">5to</option>
                <option value="6to">6to</option>
              </select>
            </div>
          </div>
        </div>
      }

      <!-- Step 2: Datos del apoderado -->
      @if (currentStep === 2) {
        <div>
          <h5 class="fw-semibold mb-4">Datos del apoderado</h5>
          
          <div class="row mb-3">
            <div class="col-md-4">
              <label class="form-label fw-medium small">Nombre *</label>
              <input 
                type="text" 
                class="form-control bg-light rounded" 
                placeholder="Nombre"
                [(ngModel)]="guardianData.firstName"
                name="guardianFirstName"
                required>
            </div>
            <div class="col-md-4">
              <label class="form-label fw-medium small">Apellido Paterno *</label>
              <input 
                type="text" 
                class="form-control bg-light rounded" 
                placeholder="Apellido Paterno"
                [(ngModel)]="guardianData.paternalLastName"
                name="guardianPaternalLastName"
                required>
            </div>
            <div class="col-md-4">
              <label class="form-label fw-medium small">Apellido Materno</label>
              <input 
                type="text" 
                class="form-control bg-light rounded" 
                placeholder="Apellido Materno"
                [(ngModel)]="guardianData.maternalLastName"
                name="guardianMaternalLastName">
            </div>
          </div>
          
          <div class="row mb-3">
            <div class="col-md-6">
              <label class="form-label fw-medium small">Tipo de Documento</label>
              <select 
                class="form-select bg-light rounded"
                [(ngModel)]="guardianData.documentType"
                name="guardianDocumentType">
                <option value="DNI">DNI</option>
                <option value="CE">Carnet de Extranjería</option>
                <option value="Pasaporte">Pasaporte</option>
              </select>
            </div>
            <div class="col-md-6">
              <label class="form-label fw-medium small">N° Documento *</label>
              <input 
                type="text" 
                class="form-control bg-light rounded" 
                placeholder="N° Documento"
                [(ngModel)]="guardianData.documentNumber"
                name="guardianDocumentNumber"
                required>
            </div>
          </div>
          
          <div class="row mb-3">
            <div class="col-md-6">
              <label class="form-label fw-medium small">Fecha de Nacimiento</label>
              <input 
                type="date" 
                class="form-control bg-light rounded"
                [(ngModel)]="guardianData.birthDate"
                name="guardianBirthDate">
            </div>
            <div class="col-md-6">
              <label class="form-label fw-medium small">Sexo</label>
              <select 
                class="form-select bg-light rounded"
                [(ngModel)]="guardianData.gender"
                name="guardianGender">
                <option value="">Seleccionar</option>
                <option value="Masculino">Masculino</option>
                <option value="Femenino">Femenino</option>
              </select>
            </div>
          </div>
          
          <div class="row mb-4">
            <div class="col-md-4">
              <label class="form-label fw-medium small">Celular *</label>
              <input 
                type="tel" 
                class="form-control bg-light rounded" 
                placeholder="Celular"
                [(ngModel)]="guardianData.phone"
                name="guardianPhone"
                required>
            </div>
            <div class="col-md-4">
              <label class="form-label fw-medium small">Dirección</label>
              <input 
                type="text" 
                class="form-control bg-light rounded" 
                placeholder="Dirección"
                [(ngModel)]="guardianData.address"
                name="guardianAddress">
            </div>
            <div class="col-md-4">
              <label class="form-label fw-medium small">Correo Electrónico</label>
              <input 
                type="email" 
                class="form-control bg-light rounded" 
                placeholder="Correo Electrónico"
                [(ngModel)]="guardianData.email"
                name="guardianEmail">
            </div>
          </div>
        </div>
      }

      <!-- Step 3: Verificar -->
      @if (currentStep === 3) {
        <div>
          <h5 class="fw-semibold mb-4">Datos del alumno</h5>
          <div class="bg-light p-3 rounded mb-4">
            <div class="row">
              <div class="col-md-6">
                <p class="mb-2"><strong>Nombre y apellidos:</strong> {{ getStudentFullName() || 'No especificado' }}</p>
                <p class="mb-2"><strong>Tipo de documento:</strong> {{ studentData.documentType || 'No especificado' }}</p>
                <p class="mb-2"><strong>N° documento:</strong> {{ studentData.documentNumber || 'No especificado' }}</p>
                <p class="mb-2"><strong>Celular:</strong> {{ studentData.phone || 'No especificado' }}</p>
                <p class="mb-0"><strong>Dirección:</strong> {{ studentData.address || 'No especificado' }}</p>
              </div>
              <div class="col-md-6">
                <p class="mb-2"><strong>Fecha de nacimiento:</strong> {{ formatDate(studentData.birthDate) || 'No especificado' }}</p>
                <p class="mb-2"><strong>Sexo:</strong> {{ studentData.gender || 'No especificado' }}</p>
                <p class="mb-2"><strong>Correo Electrónico:</strong> {{ studentData.email || 'No especificado' }}</p>
                <p class="mb-2"><strong>Nivel:</strong> {{ studentData.level || 'No especificado' }}</p>
                <p class="mb-0"><strong>Grado:</strong> {{ studentData.grade || 'No especificado' }}</p>
              </div>
            </div>
          </div>
          
          <h5 class="fw-semibold mb-4">Datos del apoderado</h5>
          <div class="bg-light p-3 rounded mb-4">
            <div class="row">
              <div class="col-md-6">
                <p class="mb-2"><strong>Nombre y apellidos:</strong> {{ getGuardianFullName() || 'No especificado' }}</p>
                <p class="mb-2"><strong>Tipo de documento:</strong> {{ guardianData.documentType || 'No especificado' }}</p>
                <p class="mb-2"><strong>N° documento:</strong> {{ guardianData.documentNumber || 'No especificado' }}</p>
                <p class="mb-0"><strong>Celular:</strong> {{ guardianData.phone || 'No especificado' }}</p>
              </div>
              <div class="col-md-6">
                <p class="mb-2"><strong>Fecha de nacimiento:</strong> {{ formatDate(guardianData.birthDate) || 'No especificado' }}</p>
                <p class="mb-2"><strong>Sexo:</strong> {{ guardianData.gender || 'No especificado' }}</p>
                <p class="mb-2"><strong>Correo Electrónico:</strong> {{ guardianData.email || 'No especificado' }}</p>
                <p class="mb-0"><strong>Dirección:</strong> {{ guardianData.address || 'No especificado' }}</p>
              </div>
            </div>
          </div>
        </div>
      }

      <!-- Step 4: Confirmación -->
      @if (currentStep === 4) {
        <div class="text-center mt-4">
          <div class="bg-success rounded-circle d-flex align-items-center justify-content-center mx-auto mb-4"
               style="width: 60px; height: 60px;">
            <i class="fas fa-check text-white fs-4"></i>
          </div>
          <h5 class="fw-semibold mb-3">¡Inscripción completada!</h5>
          <p class="fw-regular">
            Nos comunicaremos contigo para<br>
            continuar con el proceso de<br>
            admisión.
          </p>
        </div>
      }
    </form>
  </div>

  <div class="modal-footer bg-white border-top d-flex justify-content-end gap-2 p-3">
    @if (currentStep === 4) {
      <button 
        type="button" 
        class="btn btn-success rounded px-4"
        (click)="modal.close()">
        Cerrar
      </button>
    } @else {
      <button 
        type="button" 
        class="btn btn-outline-success rounded px-4" 
        (click)="previousStep()" 
        [disabled]="currentStep === 1">
        Regresar
      </button>
      <button 
        type="button" 
        class="btn btn-success rounded px-4" 
        (click)="currentStep === 3 ? completeEnrollment() : nextStep()"
        [disabled]="!canProceedToNextStep()">
        {{ currentStep === 3 ? 'Inscribirse' : 'Continuar' }}
      </button>
    }
  </div>
</ng-template>
